---
import BaseHead from "../components/BaseHead.astro";
import AnimatedTitleBox from "../components/AnimatedTitleBox.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { getCollection, render } from "astro:content";

// Get the homepage content
const homepageContent = await getCollection("homepage");
const homepage = homepageContent[0]; // Get the first (and only) homepage entry
const { Content } = await render(homepage);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<!-- Fixed Atlas Logo Easter Egg -->
		<div class="atlas-logo">
			<!-- Progress Ring -->
			<svg class="progress-ring" viewBox="0 0 200 200">
				<!-- Background ring -->
				<circle
					cx="100"
					cy="100"
					r="90"
					fill="none"
					stroke="#e6e6e6"
					stroke-width="4"
					stroke-opacity="0.3"></circle>
				<!-- Single continuous progress ring -->
				<circle
					id="progress-circle"
					cx="100"
					cy="100"
					r="90"
					fill="none"
					stroke="#ffffff"
					stroke-width="4"
					stroke-opacity="0.5"
					stroke-dasharray="565.48"
					stroke-dashoffset="565.48"
					transform="rotate(-90 100 100)"></circle>
			</svg>
			<img
				src="/atlas-compass-outer.svg"
				alt="Atlas Compass Outer"
				class="compass-outer"
			/>
			<img
				src="/atlas-compass-inner.svg"
				alt="Atlas Book Inner"
				class="compass-inner"
			/>
		</div>

		<!-- Unified Background -->
		<div class="master-background"></div>

		<!-- Animated Title Box Component -->
		<AnimatedTitleBox title={SITE_TITLE} subtitle={homepage.data.description} />

		<div class="page-layout">
			<!-- Left column: Custom scrollbar -->
			<div class="scrollbar-column">
				<div class="custom-scrollbar">
					<div class="scrollbar-track">
						<div class="ruler-markings"></div>
						<div class="scroll-indicator"></div>
					</div>
				</div>
			</div>

			<!-- Single column content area -->
			<div class="main-content">
				<main>
					<div class="hero-container">
						<!-- Placeholder for hero area - title is now handled by AnimatedTitleBox -->
					</div>
				</main>

				<section class="content-section">
					<div class="scroll-content">
						<Content />
					</div>
				</section>
			</div>
		</div>

		<!--
	ðŸŒŸ CLOUDFLARE ATLAS - COMPONENT GUIDE ðŸŒŸ
	
	This is the main index page that coordinates all components. To modify different
	parts of the site, edit the following files:
	
	ðŸ“ CONTENT & STRUCTURE:
	â”œâ”€â”€ src/pages/index.astro â† This file (main layout, HTML structure, CSS)
	â”œâ”€â”€ src/content/homepage/ â† Page content and metadata
	â””â”€â”€ src/components/ â† Reusable Astro components
	
	ðŸŽ¨ STYLING:
	â”œâ”€â”€ <style> section below â† All CSS styling and responsive design
	â”œâ”€â”€ CSS variables at top â† Color scheme and design tokens
	â””â”€â”€ Component-specific styles â† Organized by component
	
	âš¡ JAVASCRIPT BEHAVIOR (src/scripts/):
	â”œâ”€â”€ main.js â† Central coordinator and app initialization
	â”œâ”€â”€ textAnimations.js â† SplitText word-by-word animations
	â”œâ”€â”€ customScrollbar.js â† Section-based scrollbar with equidistant clickable navigation
	â”œâ”€â”€ progressSystem.js â† Circular progress ring and compass rotation
	â”œâ”€â”€ panelAnimations.js â† Content panel fade/slide effects
	â””â”€â”€ scrollBehavior.js â† Logo movement and background scrolling
	
	ðŸ”§ CONFIGURATION:
	Each script file has a CONFIG object at the top for easy customization:
	- Animation timing and easing
	- Visual appearance settings
	- Behavior thresholds and triggers
	- Performance and debug options
	
	ðŸ“± RESPONSIVE DESIGN:
	All responsive breakpoints and mobile adaptations are in the CSS below.
	
	ðŸš€ ADDING CONTENT:
	- Add content panels: Just add more .content-panel-small or .content-panel-large
	- All animations and progress tracking will work automatically
	- No JavaScript changes needed for additional content
	
	ðŸ’¡ PERFORMANCE:
	- All scripts use requestAnimationFrame for smooth 60fps animations
	- Scroll events are throttled for optimal performance
	- Modular architecture allows easy optimization of individual components
	
	ðŸ› DEBUGGING:
	Set enableLogging: true in main.js APP_CONFIG for detailed console output
-->

		<script type="module" src="/src/scripts/main.js"></script>

		<style>
			:root {
				overscroll-behavior: none;
			}

			/* Base & Scrollbars */
			html,
			body,
			* {
				scrollbar-width: none;
				-ms-overflow-style: none;
			}
			html::-webkit-scrollbar,
			body::-webkit-scrollbar,
			*::-webkit-scrollbar {
				display: none;
			}

			body {
				margin: 0;
				padding: 0;
				min-height: 100vh;
				overflow-x: hidden;
				background: #bbdefb; /* Fallback color matching gradient end */
			}

			/* Layout */
			.page-layout {
				display: flex;
				width: 100vw;
				min-height: 100vh;
				overflow-x: hidden;
				flex-direction: column;
			}

			.scrollbar-column {
				position: fixed;
				left: 0;
				top: 0;
				width: 80px;
				height: 100vh;
				z-index: 1000;
			}

			.main-content {
				margin-left: 80px; /* Account for scrollbar */
				margin-right: 80px; /* Balanced margins */
				min-height: 100vh;
				width: calc(100vw - 160px); /* Full width minus margins */
			}

			/* Custom Scrollbar */
			.custom-scrollbar {
				position: fixed;
				left: 1.5rem;
				top: 5vh;
				height: 90vh;
				width: 30px;
				z-index: 1000;
				pointer-events: none;
			}

			.scrollbar-track {
				width: 100%;
				height: 100%;
				background: rgba(255, 255, 255, 0.1);
				border-radius: 15px;
				border: 1px solid var(--glass-border);
				backdrop-filter: blur(5px);
			}

			.ruler-markings {
				position: absolute;
				width: 100%;
				height: 100%;
				pointer-events: none; /* Disable for container */
			}

			.ruler-mark {
				position: absolute;
				left: 50%;
				transform: translateX(-50%);
				height: 1.5px;
				background: #ffffff;
				z-index: 50; /* Below scroll indicator */
			}
			.ruler-mark.short {
				width: 12px;
			}
			.ruler-mark.long {
				width: 20px;
				height: 3px;
			}

			/* Enable clicks for major marks with navigation */
			.ruler-mark.clickable-mark {
				pointer-events: auto !important;
				cursor: pointer !important;
				transition: all 0.2s ease;
				z-index: 100 !important; /* Above regular marks but below scroll indicator */
				position: absolute !important; /* Ensure proper positioning */
			}

			.ruler-mark.clickable-mark:hover {
				transform: translateX(-50%) scale(1.2) !important;
				box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
			}

			.ruler-mark.clickable-mark:active {
				transform: translateX(-50%) scale(1.1) !important;
			}

			/* Debug styling to make clickable marks more visible */
			.ruler-mark.clickable-mark {
				border: 1px solid rgba(255, 255, 255, 0.3);
				background-color: #ffffff !important;
			}

			.scroll-indicator {
				position: absolute;
				left: 50%;
				transform: translateX(-50%);
				width: 20px;
				height: 3px;
				background: #ff4444;
				/* border-radius: 2px; */ /* Removed for angular/rectangular shape */
				box-shadow: 0 0 8px rgba(255, 68, 68, 0.5);
				transition: top 0.1s ease-out;
				z-index: 200; /* Above all ruler marks */
			}

			/* Unified Master Background */
			.master-background {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 300vh; /* Extended to cover more scroll area */
				background: linear-gradient(to bottom, var(--accent-color), #bbdefb);
				z-index: -1;
			}

			/* Hero Section */
			main {
				height: 100vh;
				display: flex;
				align-items: center;
			}

			.hero-container,
			.hero-text {
				width: 100%;
				box-sizing: border-box;
			}

			.hero-text {
				display: flex;
				flex-direction: column;
				justify-content: center;
				padding: 2rem;
			}

			.hero-title {
				margin: 0 0 1rem 0;
			}

			.title-word,
			.hero-subtitle {
				color: var(--primary-color);
				word-wrap: break-word;
				max-width: 100%;
			}

			.title-word {
				font-size: clamp(3rem, 8vw, 6rem);
				font-weight: bold;
				line-height: 1.1;
				display: block;
			}

			.hero-subtitle {
				font-size: clamp(1.2rem, 3vw, 2rem);
				margin: 0;
				font-weight: 300;
			}

			/* Hero Image & Atlas Logo */
			.hero-image {
				position: fixed;
				top: 0;
				right: 0;
				width: 50vw;
				height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				z-index: 1;
				background: transparent;
			}

			.image-column {
				position: relative;
				width: 50vw;
			}

			.atlas-logo {
				position: fixed !important;
				top: 2rem !important;
				right: 2rem !important;
				width: 80px;
				height: 80px;
				z-index: 1000;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: transform 0.3s ease;
				cursor: pointer;
				transform: none !important; /* Prevent any scroll-based transforms */
			}

			.atlas-logo:hover {
				transform: scale(
					1.1
				) !important; /* Override the transform: none for hover */
			}

			.compass-outer {
				width: 60px;
				height: 60px;
				transform-origin: center center;
			}

			.compass-inner {
				position: absolute;
				width: 18px;
				height: 18px;
				z-index: 2;
			}

			.progress-ring {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 72px;
				height: 72px;
				z-index: 3;
				pointer-events: none;
			}

			#progress-circle {
				transition: stroke-dashoffset 0.3s ease-out;
			}

			/* Content Panels */
			.content-section {
				color: var(--primary-color);
				padding: 2rem;
				width: 100%;
				box-sizing: border-box;
			}

			/* Mobile */
			@media (max-width: 768px) {
				.hero-container {
					flex-direction: column;
					padding: 1rem;
				}
				.hero-text {
					order: 1;
				}
				.hero-image {
					order: 2;
					max-width: 80%;
				}
				.content-section {
					width: 100% !important;
					padding: 2rem;
				}
			}
		</style>
	</body>
</html>
