---
import BaseHead from "../components/BaseHead.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { getCollection, render } from "astro:content";

// Get the homepage content
const homepageContent = await getCollection("homepage");
const homepage = homepageContent[0]; // Get the first (and only) homepage entry
const { Content } = await render(homepage);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<!-- Fixed Atlas Logo Easter Egg -->
		<div class="atlas-logo">
			<!-- Progress Ring -->
			<svg class="progress-ring" viewBox="0 0 200 200">
				<!-- Background ring -->
				<circle
					cx="100"
					cy="100"
					r="90"
					fill="none"
					stroke="#e6e6e6"
					stroke-width="4"
					stroke-opacity="0.3"></circle>
				<!-- Single continuous progress ring -->
				<circle
					id="progress-circle"
					cx="100"
					cy="100"
					r="90"
					fill="none"
					stroke="#ffffff"
					stroke-width="4"
					stroke-opacity="0.5"
					stroke-dasharray="565.48"
					stroke-dashoffset="565.48"
					transform="rotate(-90 100 100)"></circle>
			</svg>
			<img
				src="/atlas-compass-outer.svg"
				alt="Atlas Compass Outer"
				class="compass-outer"
			/>
			<img
				src="/atlas-compass-inner.svg"
				alt="Atlas Book Inner"
				class="compass-inner"
			/>
		</div>

		<!-- Unified Background -->
		<div class="master-background"></div>

		<div class="page-layout">
			<!-- Left column: Custom scrollbar -->
			<div class="scrollbar-column">
				<div class="custom-scrollbar">
					<div class="scrollbar-track">
						<div class="ruler-markings"></div>
						<div class="scroll-indicator"></div>
					</div>
				</div>
			</div>

			<!-- Content area that will scroll together -->
			<div class="scrollable-content">
				<!-- Middle column: Content -->
				<div class="content-column">
					<main>
						<div class="hero-container">
							<div class="hero-text">
								<div class="hero-title">
									<div class="title-word">Cloudflare</div>
									<div class="title-word">Atlas</div>
								</div>
								<p class="hero-subtitle">{homepage.data.description}</p>
							</div>
						</div>
					</main>

					<section class="content-section">
						<div class="scroll-content grid square-grid">
							<!-- Devdocs -->
							<section class="content-panel-small" id="devdocs">
								<h1>Developer Documentation</h1>
								<p>Dive into the details about Cloudflare's products.</p>
								<hr class="panel-divider" />
								<ul>
									<li>
										<a href="https://developers.cloudflare.com/"
											>Full developer documentation</a
										>
									</li>
									<li>
										<a href="https://developers.cloudflare.com/directory/"
											>All products</a
										>
									</li>
								</ul>
							</section>

							<!-- Blogs -->
							<section class="content-panel-small" id="blog">
								<h1>Blogs</h1>
								<p>
									Read everything from technical deep-dives powering our
									technology to new ideas in the future of the internet.
								</p>
								<hr class="panel-divider" />
								<ul>
									<li>
										<a href="https://blog.cloudflare.com/">Cloudflare Blog</a>
									</li>
								</ul>
							</section>

							<!-- Research -->
							<section class="content-panel-small" id="research">
								<h1>Cloudflare Research</h1>
								<p>
									Learn how we are planning to help build a better internet.
								</p>
								<hr class="panel-divider" />
								<ul>
									<li>
										<a href="https://research.cloudflare.com/"
											>Cloudflare Research</a
										>
									</li>
								</ul>
							</section>

							<!-- University -->
							<section class="content-panel-small" id="university">
								<h1>Cloudflare University</h1>
								<p>Take courses to earn Cloudflare certifications.</p>
								<hr class="panel-divider" />
								<ul>
									<li>
										<a href="https://university.cloudflare.com/"
											>Cloudflare University</a
										>
									</li>
								</ul>
							</section>
						</div>
					</section>
				</div>

				<!-- Right column: Hero image -->
				<div class="image-column">
					<div class="hero-image">
						<!-- Hero image content can go here if needed -->
					</div>
				</div>
			</div>

			<!-- All Resources - spans both columns -->
			<section class="content-panel-large" id="all-resources">
				<h1>All Resources</h1>
				<p>
					Access a comprehensive collection of Cloudflare tools and resources.
				</p>
				<hr class="panel-divider" />
			</section>
		</div>

		<!--
	🌟 CLOUDFLARE ATLAS - COMPONENT GUIDE 🌟
	
	This is the main index page that coordinates all components. To modify different
	parts of the site, edit the following files:
	
	📝 CONTENT & STRUCTURE:
	├── src/pages/index.astro ← This file (main layout, HTML structure, CSS)
	├── src/content/homepage/ ← Page content and metadata
	└── src/components/ ← Reusable Astro components
	
	🎨 STYLING:
	├── <style> section below ← All CSS styling and responsive design
	├── CSS variables at top ← Color scheme and design tokens
	└── Component-specific styles ← Organized by component
	
	⚡ JAVASCRIPT BEHAVIOR (src/scripts/):
	├── main.js ← Central coordinator and app initialization
	├── textAnimations.js ← SplitText word-by-word animations
	├── customScrollbar.js ← Section-based scrollbar with equidistant clickable navigation
	├── progressSystem.js ← Circular progress ring and compass rotation
	├── panelAnimations.js ← Content panel fade/slide effects
	└── scrollBehavior.js ← Logo movement and background scrolling
	
	🔧 CONFIGURATION:
	Each script file has a CONFIG object at the top for easy customization:
	- Animation timing and easing
	- Visual appearance settings
	- Behavior thresholds and triggers
	- Performance and debug options
	
	📱 RESPONSIVE DESIGN:
	All responsive breakpoints and mobile adaptations are in the CSS below.
	
	🚀 ADDING CONTENT:
	- Add content panels: Just add more .content-panel-small or .content-panel-large
	- All animations and progress tracking will work automatically
	- No JavaScript changes needed for additional content
	
	💡 PERFORMANCE:
	- All scripts use requestAnimationFrame for smooth 60fps animations
	- Scroll events are throttled for optimal performance
	- Modular architecture allows easy optimization of individual components
	
	🐛 DEBUGGING:
	Set enableLogging: true in main.js APP_CONFIG for detailed console output
-->

		<script type="module" src="/src/scripts/main.js"></script>

		<style>
			:root {
				overscroll-behavior: none;
				--primary-color: #333;
				--accent-color: #066eb9;
				--glass-bg: rgba(255, 255, 255, 0.15);
				--glass-border: rgba(255, 255, 255, 0.2);
				--glass-divider: rgba(51, 51, 51, 0.4);
			}

			/* Base & Scrollbars */
			html,
			body,
			* {
				scrollbar-width: none;
				-ms-overflow-style: none;
			}
			html::-webkit-scrollbar,
			body::-webkit-scrollbar,
			*::-webkit-scrollbar {
				display: none;
			}

			body {
				margin: 0;
				padding: 0;
				min-height: 100vh;
				overflow-x: hidden;
				background: #bbdefb; /* Fallback color matching gradient end */
			}

			/* Layout */
			.page-layout {
				display: flex;
				width: 100vw;
				min-height: 100vh;
				overflow-x: hidden;
				flex-direction: column;
			}

			.scrollbar-column {
				position: fixed;
				left: 0;
				top: 0;
				width: 80px;
				height: 100vh;
				z-index: 1000;
			}

			.scrollable-content {
				display: flex;
				margin-left: 80px;
			}

			.content-column {
				flex: 1;
				min-height: 100vh;
				max-width: calc(50vw - 80px);
				overflow: hidden;
			}
			.image-column {
				flex: 0 0 50vw;
			}

			/* Custom Scrollbar */
			.custom-scrollbar {
				position: fixed;
				left: 1.5rem;
				top: 5vh;
				height: 90vh;
				width: 30px;
				z-index: 1000;
				pointer-events: none;
			}

			.scrollbar-track {
				width: 100%;
				height: 100%;
				background: rgba(255, 255, 255, 0.1);
				border-radius: 15px;
				border: 1px solid var(--glass-border);
				backdrop-filter: blur(5px);
			}

			.ruler-markings {
				position: absolute;
				width: 100%;
				height: 100%;
				pointer-events: none; /* Disable for container */
			}

			.ruler-mark {
				position: absolute;
				left: 50%;
				transform: translateX(-50%);
				height: 1.5px;
				background: #ffffff;
				z-index: 50; /* Below scroll indicator */
			}
			.ruler-mark.short {
				width: 12px;
			}
			.ruler-mark.long {
				width: 20px;
				height: 3px;
			}

			/* Enable clicks for major marks with navigation */
			.ruler-mark.clickable-mark {
				pointer-events: auto !important;
				cursor: pointer !important;
				transition: all 0.2s ease;
				z-index: 100 !important; /* Above regular marks but below scroll indicator */
				position: absolute !important; /* Ensure proper positioning */
			}

			.ruler-mark.clickable-mark:hover {
				transform: translateX(-50%) scale(1.2) !important;
				box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
			}

			.ruler-mark.clickable-mark:active {
				transform: translateX(-50%) scale(1.1) !important;
			}

			/* Debug styling to make clickable marks more visible */
			.ruler-mark.clickable-mark {
				border: 1px solid rgba(255, 255, 255, 0.3);
				background-color: #ffffff !important;
			}

			.scroll-indicator {
				position: absolute;
				left: 50%;
				transform: translateX(-50%);
				width: 20px;
				height: 3px;
				background: #ff4444;
				/* border-radius: 2px; */ /* Removed for angular/rectangular shape */
				box-shadow: 0 0 8px rgba(255, 68, 68, 0.5);
				transition: top 0.1s ease-out;
				z-index: 200; /* Above all ruler marks */
			}

			/* Unified Master Background */
			.master-background {
				position: fixed;
				top: 0;
				left: 0;
				width: 100vw;
				height: 300vh; /* Extended to cover more scroll area */
				background: linear-gradient(to bottom, var(--accent-color), #bbdefb);
				z-index: -1;
			}

			/* Hero Section */
			main {
				height: 100vh;
				display: flex;
				align-items: center;
			}

			.hero-container,
			.hero-text {
				width: 100%;
				box-sizing: border-box;
			}

			.hero-text {
				display: flex;
				flex-direction: column;
				justify-content: center;
				padding: 2rem;
			}

			.hero-title {
				margin: 0 0 1rem 0;
			}

			.title-word,
			.hero-subtitle {
				color: var(--primary-color);
				word-wrap: break-word;
				max-width: 100%;
			}

			.title-word {
				font-size: clamp(3rem, 8vw, 6rem);
				font-weight: bold;
				line-height: 1.1;
				display: block;
			}

			.hero-subtitle {
				font-size: clamp(1.2rem, 3vw, 2rem);
				margin: 0;
				font-weight: 300;
			}

			/* Hero Image & Atlas Logo */
			.hero-image {
				position: fixed;
				top: 0;
				right: 0;
				width: 50vw;
				height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				z-index: 1;
				background: transparent;
			}

			.image-column {
				position: relative;
				width: 50vw;
			}

			.atlas-logo {
				position: fixed !important;
				top: 2rem !important;
				right: 2rem !important;
				width: 80px;
				height: 80px;
				z-index: 1000;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: transform 0.3s ease;
				cursor: pointer;
				transform: none !important; /* Prevent any scroll-based transforms */
			}

			.atlas-logo:hover {
				transform: scale(
					1.1
				) !important; /* Override the transform: none for hover */
			}

			.compass-outer {
				width: 60px;
				height: 60px;
				transform-origin: center center;
			}

			.compass-inner {
				position: absolute;
				width: 18px;
				height: 18px;
				z-index: 2;
			}

			.progress-ring {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 72px;
				height: 72px;
				z-index: 3;
				pointer-events: none;
			}

			#progress-circle {
				transition: stroke-dashoffset 0.3s ease-out;
			}

			/* Content Panels */
			.content-section {
				color: var(--primary-color);
				padding: 2rem;
				width: 100%;
				box-sizing: border-box;
			}

			/* Small Content Panels */
			.content-panel-small {
				width: 70%;
				margin: 75vh 0 0 0;
				background: var(--glass-bg);
				backdrop-filter: blur(10px);
				border: 1px solid var(--glass-border);
				border-radius: 20px;
				padding: 2rem;
				box-sizing: border-box;
				word-wrap: break-word;
				opacity: 0.2;
			}
			.content-panel-small:first-child {
				margin-top: 0;
			}

			/* Large Content Panel */
			.content-panel-large {
				position: relative;
				width: calc(100vw - 300px);
				margin-left: 150px;
				margin-right: 150px;
				margin-top: 75vh;
				margin-bottom: 75vh;
				background: var(--glass-bg);
				backdrop-filter: blur(10px);
				border: 1px solid var(--glass-border);
				border-radius: 20px;
				padding: 2rem;
				box-sizing: border-box;
				word-wrap: break-word;
				opacity: 0.2;
				z-index: 10;
			}

			/* Content Panel Elements (applies to both small and large) */
			.content-panel-small h1,
			.content-panel-small h2,
			.content-panel-small p,
			.content-panel-small a,
			.content-panel-large h1,
			.content-panel-large h2,
			.content-panel-large p,
			.content-panel-large a {
				color: var(--primary-color);
				word-wrap: break-word;
				max-width: 100%;
			}

			.content-panel-small h1,
			.content-panel-large h1 {
				font-size: clamp(2rem, 5vw, 2.5rem);
				margin: 0 0 1.5rem 0;
				font-weight: bold;
			}

			.content-panel-small h2,
			.content-panel-large h2 {
				font-size: clamp(1.5rem, 4vw, 2rem);
				margin: 2rem 0 1rem 0;
				font-weight: bold;
			}

			.content-panel-small p,
			.content-panel-large p {
				font-size: clamp(1rem, 3vw, 1.2rem);
				line-height: 1.6;
				margin: 0;
			}

			.content-panel-small ul,
			.content-panel-large ul {
				list-style: none;
				padding: 0;
				margin: 0.25rem 0 0 0;
			}

			.content-panel-small li,
			.content-panel-large li {
				margin: 0.5rem 0;
			}

			.content-panel-small a,
			.content-panel-large a {
				font-size: clamp(0.9rem, 2.5vw, 1rem);
				text-decoration: none;
				transition: color 0.3s ease;
				line-height: 1.2;
				display: block;
				transform: translateX(-2rem);
				opacity: 0;
				transition:
					transform 0.4s ease-out,
					opacity 0.4s ease-out,
					color 0.3s ease;
			}

			.content-panel-small a.animate-in,
			.content-panel-large a.animate-in {
				transform: translateX(0);
				opacity: 1;
			}
			.content-panel-small a::before,
			.content-panel-large a::before {
				content: "→";
				margin-right: 0.5rem;
			}
			.content-panel-small a:hover,
			.content-panel-large a:hover {
				color: #0051c3;
			}

			.panel-divider {
				border: none;
				height: 3px;
				background: var(--glass-divider);
				margin: 1.5rem 0 0 0;
				width: 0%;
				transition: none;
			}

			/* Mobile */
			@media (max-width: 768px) {
				.hero-container {
					flex-direction: column;
					padding: 1rem;
				}
				.hero-text {
					order: 1;
				}
				.hero-image {
					order: 2;
					max-width: 80%;
				}
				.content-section {
					width: 100% !important;
					padding: 2rem;
				}
			}
		</style>
	</body>
</html>
